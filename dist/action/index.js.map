{"version":3,"file":"index.js","sources":["../../src/action/applyStyles.js","../../src/action/resizeObserver.js"],"sourcesContent":["/**\r\n * Provides an action to apply style properties provided as an object.\r\n *\r\n * @param {HTMLElement} node - Target element\r\n *\r\n * @param {object}      properties - Key / value object of properties to set.\r\n *\r\n * @returns {Function} Update function.\r\n */\r\nexport function applyStyles(node, properties)\r\n{\r\n   /** Sets properties on node. */\r\n   function setProperties()\r\n   {\r\n      if (typeof properties !== 'object') { return; }\r\n\r\n      for (const prop of Object.keys(properties))\r\n      {\r\n         node.style.setProperty(`${prop}`, properties[prop]);\r\n      }\r\n   }\r\n\r\n   setProperties();\r\n\r\n   return {\r\n      update(newProperties)\r\n      {\r\n         properties = newProperties;\r\n         setProperties();\r\n      }\r\n   };\r\n}\r\n","import { isWritableStore } from '@typhonjs-svelte/lib/store';\r\n\r\n/**\r\n * Provides an action to monitor the given HTMLElement node with `ResizeObserver` posting width / height changes\r\n * to the target in various ways depending on the shape of the target. The target can be one of the following and the\r\n * precedence order is listed from top to bottom:\r\n *\r\n *\r\n * - has a `setDimension` function as attribute; width / height are passed as parameters.\r\n * - has `setWidth` & `setHeight` functions as attribute; width & height are passed as parameters.\r\n * - has\r\n * - target is an object; width and height attributes are directly set on target.\r\n * - target is a function; the function is invoked with width & height parameters.\r\n *\r\n * Note: Svelte currently uses an archaic IFrame based workaround to monitor offset / client width & height changes.\r\n * A more up to date way to do this is with ResizeObserver. To track when Svelte receives ResizeObserver support\r\n * monitor this issue: {@link https://github.com/sveltejs/svelte/issues/4233}\r\n *\r\n * Can-I-Use: {@link https://caniuse.com/resizeobserver}\r\n *\r\n * @param {HTMLElement}       node - The node associated with the action.\r\n *\r\n * @param {object | Function} target - An object to update with observed width & height changes.\r\n *\r\n * @returns {{update: Function, destroy: Function}} The action lifecycle methods.\r\n * @see {@link https://github.com/sveltejs/svelte/issues/4233}\r\n */\r\nexport function resizeObserver(node, target)\r\n{\r\n   let updateType = setUpdateType(target);\r\n\r\n   const observer = new ResizeObserver((entries) =>\r\n   {\r\n      for (const entry of entries)\r\n      {\r\n         // An early out verifying that the entry matches the node.\r\n         if (node !== entry?.target) { return; }\r\n\r\n         switch (updateType)\r\n         {\r\n            case s_UPDATE_TYPES.attribute:\r\n               target.width = entry.contentRect.width;\r\n               target.height = entry.contentRect.height;\r\n               break;\r\n\r\n            case s_UPDATE_TYPES.function:\r\n               target(entry.contentRect.width, entry.contentRect.height);\r\n               break;\r\n\r\n            case s_UPDATE_TYPES.setDimension:\r\n               target.setDimension?.(entry.contentRect.width, entry.contentRect.height);\r\n               break;\r\n\r\n            case s_UPDATE_TYPES.setWidthAndHeight:\r\n               target.setWidth?.(entry.contentRect.width);\r\n               target.setHeight?.(entry.contentRect.height);\r\n               break;\r\n\r\n            case s_UPDATE_TYPES.storeObject:\r\n               target.width.set(entry.contentRect.width);\r\n               target.height.set(entry.contentRect.height);\r\n               break;\r\n         }\r\n      }\r\n   });\r\n\r\n   observer.observe(node);\r\n\r\n   return {\r\n      update: (newTarget) =>\r\n      {\r\n         updateType = setUpdateType(newTarget);\r\n         target = newTarget;\r\n      },\r\n\r\n      destroy: () =>\r\n      {\r\n         observer.unobserve(node);\r\n         observer.disconnect();\r\n      }\r\n   };\r\n}\r\n\r\n/**\r\n * Defines the various shape / update type of the given target.\r\n *\r\n * @type {Record<string, number>}\r\n */\r\nconst s_UPDATE_TYPES = {\r\n   none: 0,\r\n   attribute: 1,\r\n   function: 2,\r\n   setDimension: 3,\r\n   setWidthAndHeight: 4,\r\n   storeObject: 5\r\n};\r\n\r\n/**\r\n * Determines the shape of the target instance regarding valid update mechanisms to set width & height changes.\r\n *\r\n * @param {*}  target - The target instance.\r\n *\r\n * @returns {number} Update type value.\r\n */\r\nfunction setUpdateType(target)\r\n{\r\n   if (target?.setDimension instanceof Function) { return s_UPDATE_TYPES.setDimension; }\r\n\r\n   if (target?.setWidth instanceof Function && target?.setHeight instanceof Function)\r\n   {\r\n      return s_UPDATE_TYPES.setWidthAndHeight;\r\n   }\r\n\r\n   const targetType = typeof target;\r\n\r\n   // Does the target have width & height writable store attributes?\r\n   if ((targetType === 'object' || targetType === 'function') && isWritableStore(target.width) &&\r\n    isWritableStore(target.height))\r\n   {\r\n      return s_UPDATE_TYPES.storeObject;\r\n   }\r\n\r\n   if (targetType === 'object') { return s_UPDATE_TYPES.attribute; }\r\n\r\n   if (targetType === 'function') { return s_UPDATE_TYPES.function; }\r\n\r\n   return s_UPDATE_TYPES.none;\r\n}\r\n"],"names":[],"mappings":"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"}